<!DOCTYPE html>
<html>
  <head>
		<title>tracks</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 70%; margin: 0; padding: 0 }
    </style>
    <script type="text/javascript"
		      src="http://maps.googleapis.com/maps/api/js?sensor=false">
					    </script>
		<script type="text/javascript" src="js/richmarker-compiled.js"></script>
		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="common.js"></script>
    <script type="text/javascript">

var DRAW_GRID = false;

var g_snapgridpolylines = new Array();

function initialize() {

	init_map();

    callpy('tracks.get_all_tracks_polylines',
			function(r_) {
				for(var polylinei in r_) {
					var raw_polyline = r_[polylinei];
					var cooked_polyline = new Array();
					for(var pti in raw_polyline) {
						var raw_pt = raw_polyline[pti];
						cooked_polyline.push(new google.maps.LatLng(raw_pt[0], raw_pt[1]));
					}
					new google.maps.Polyline({map: g_map, path: cooked_polyline});
				}
			});

	if(DRAW_GRID) {
		setTimeout("draw_snap_grid()", 1000);
		google.maps.event.addListener(g_map, 'dragend', draw_snap_grid);
		google.maps.event.addListener(g_map, 'zoom_changed', draw_snap_grid);
	}

}

function draw_snap_grid() {
	callpy('snaptogrid.get_display_grid', g_map.getBounds().getSouthWest(), g_map.getBounds().getNorthEast(), 
		function(r_) {
			for(var i in g_snapgridpolylines) {
				var snapgridpolyline = g_snapgridpolylines[i];
				snapgridpolyline.setMap(null);
			}
			delete g_snapgridpolylines;
			g_snapgridpolylines = new Array();

			for(var polylinei in r_) {
				var raw_polyline = r_[polylinei];
				var cooked_polyline = new Array();
				for(var pti in raw_polyline) {
					var raw_pt = raw_polyline[pti];
					cooked_polyline.push(new google.maps.LatLng(raw_pt[0], raw_pt[1]));
				}
				var newpolyline = new google.maps.Polyline({map: g_map, path: cooked_polyline, strokeWeight: 1, strokeColor: 'rgb(0,0,255)'});
				g_snapgridpolylines.push(newpolyline);
			}
		});

}

    </script>
  </head>
  <body onload="initialize()" >
		<div id="map_canvas" style="width:80%; height:100%"></div>
		<p id="p1"/>
  </body>
</html>
